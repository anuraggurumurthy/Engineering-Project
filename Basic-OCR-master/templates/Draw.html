{% extends "navbar.html" %} {% block content %}
<style>
  canvas:hover {
    cursor: crosshair;
  }
</style>

<form
  style="display: none;"
  action="/draw"
  enctype="multipart/form-data"
  method="post"
>
  <input type="file" name="image" id="" />
</form>

<div>
  <canvas
    style="
      margin-top: 100px;
      width: 70vw;
      height: 70vh;
      border: 2px solid black;
    "
    id="canvas"
  ></canvas>
  <button
    onclick="download()"
    class="cursor-pointer w-32 h-12 z-10 bg-blue-300 mx-2"
  >
    Submit
  </button>
  <button
    class="cursor-pointer w-32 h-12 z-10 bg-red-300 mx-2"
    onclick="window.location.reload()"
  >
    Clear
  </button>
  <a id="downloadLnk" download="YourFileName.jpg">Download as image</a>
</div>
<h1>Result will be displayed here:</h1>
{% if img_src %}
<img style="max-width: 400px; max-height: 300px;" src="{{ img_src }}" />
{% endif %} {% if extracted_text %}
<p>
  The extracted text from the image above is:
  <b id="extracted-text"> {{ extracted_text }} </b>
</p>
<button class="bg-blue-300 py-2 px-5 rounded" onclick="speak()">Speak</button>

{% elif extracted_text=="" %}
<p>No text found.</p>
{% endif %}
<script>
  var canvas = document.querySelector("canvas");
  // some hotfixes... ( ≖_≖)
  var ctx = canvas.getContext('2d');
resize();

// last known position
var pos = { x: 0, y: 0 };

window.addEventListener('resize', resize);
document.addEventListener('mousemove', draw);
document.addEventListener('mousedown', setPosition);
document.addEventListener('mouseenter', setPosition);

// new position from mouse event
function setPosition(e) {
  pos.x = e.clientX ;
  pos.y = e.clientY ;
}

// resize canvas
function resize() {
  ctx.canvas.width = window.innerWidth;
  ctx.canvas.height = window.innerHeight;
}

function draw(e) {
  // mouse left button must be pressed
  if (e.buttons !== 1) return;

  ctx.beginPath(); // begin

  huu,nave host madi record madbeku
  
  ctx.lineWidth = 5;
  ctx.lineCap = 'round';
  ctx.strokeStyle = '#c0392b';
  let x_offset = -420,y_offset=-80;

  ctx.moveTo(pos.x + x_offset, pos.y + y_offset); // from
  setPosition(e);
  ctx.lineTo(pos.x + x_offset , pos.y + y_offset); // to

  ctx.stroke(); // draw it!
}

  function download() {
    var dt = canvas.toDataURL("image/jpeg");
    document.querySelector("#downloadLnk").href = dt;
  }
  async function submit() {
    let blob = dataURItoBlob(canvas.toDataURL("image/jpeg"));
    let formData = new FormData();
    formData.append("image", blob, "caputre.jpg");
    const res = await axios.post("/draw", formData, {
      headers: {
        "Content-Type": "multipart/form-data",
      },
    });
    console.log(res);
  }
</script>
{% endblock %}
